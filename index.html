<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To My Melanie (è”¡è¿å›·) ğŸ’•</title>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      min-height: -webkit-fill-available;
      min-height: 100dvh;
      overflow: hidden;
      overscroll-behavior: contain;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #ffe6f2, #fff0f5, #ffe6f2);
      background-size: 300% 300%;
      animation: breatheBg 15s ease infinite;
      color: #d63384;
      touch-action: manipulation;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-bottom: env(safe-area-inset-bottom);
      position: relative;
    }

    @keyframes breatheBg {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .wrapper {
      text-align: center;
      width: 100%;
      max-width: 600px;
      padding: 20px;
      box-sizing: border-box;
      z-index: 10;
      pointer-events: auto;
      position: relative;
    }

    h1 {
      font-size: clamp(2.2rem, 7vw, 3.8rem);
      margin: 0 0 20px;
      line-height: 1.1;
      animation: pulse 2.5s infinite ease-in-out;
    }

    .subtitle {
      font-size: clamp(1.4rem, 5vw, 1.8rem);
      margin-bottom: 40px;
      color: #e91e63;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.06); }
    }

    .buttons-container {
      position: relative;
      min-height: 380px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 80px;
    }

    button {
      font-size: clamp(1.3rem, 5vw, 1.7rem);
      padding: 16px 48px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(0,0,0,0.22);
      user-select: none;
      transition: transform 0.6s ease, opacity 0.4s ease, box-shadow 0.4s ease;
      position: relative;
      z-index: 2;
    }

    #yesBtn {
      background: linear-gradient(135deg, #ff4d94, #ff80ab);
      color: white;
      animation: gentleBounce 3s infinite ease-in-out, yesGlow 4s infinite ease-in-out;
    }

    #yesBtn.not-ready,
    #yesBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      animation: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      pointer-events: none;
    }

    @keyframes gentleBounce {
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }

    @keyframes yesGlow {
      0%,100% { box-shadow: 0 0 20px rgba(255,77,148,0.6); }
      50% { box-shadow: 0 0 40px rgba(255,77,148,1); }
    }

    #noBtn {
      background: #6c757d;
      color: white;
    }

    #noBtn.surrender {
      background: linear-gradient(135deg, #ff4d94, #ff80ab);
      box-shadow: 0 0 30px rgba(255,77,148,0.8);
      font-weight: bold;
    }

    .merged-yes {
      font-size: clamp(2rem, 7vw, 3.2rem);
      padding: 24px 80px;
      background: linear-gradient(135deg, #ff4d94, #ff80ab, #ff4d94);
      color: white;
      box-shadow: 0 0 60px rgba(255,77,148,0.9);
      animation: mergedPulse 2s infinite ease-in-out, mergedGlow 3s infinite ease-in-out;
      pointer-events: auto;
      cursor: pointer;
      border: none;
      border-radius: 999px;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
      z-index: 5;
    }

    @keyframes mergedPulse {
      0%,100% { transform: translate(-50%, -50%) scale(1); }
      50%     { transform: translate(-50%, -50%) scale(1.12); }
    }

    @keyframes mergedGlow {
      0%,100% { box-shadow: 0 0 40px rgba(255,77,148,0.7); }
      50%     { box-shadow: 0 0 80px rgba(255,77,148,1); }
    }

    .heart-explosion {
      position: absolute;
      font-size: 2.5rem;
      pointer-events: none;
      animation: explodeHeart 1.2s ease-out forwards;
      opacity: 0;
      z-index: 6;
    }

    @keyframes explodeHeart {
      0%   { opacity: 1; transform: scale(0.4) translate(0,0) rotate(0deg); }
      30%  { opacity: 1; transform: scale(1.3); }
      100% { opacity: 0; transform: scale(0.8) translate(var(--dx), var(--dy)) rotate(var(--rot)); }
    }

    /* Your other existing styles (flower-decor, handwritten, memory-photo, trail-heart, spark, etc.) remain unchanged */
    .flower-decor { /* ... */ }
    .memory-photo { /* ... */ }
    .trail-heart { /* ... */ }
    .spark { /* ... */ }
    /* ... rest of your styles ... */
  </style>
</head>
<body>

<img src="https://image.similarpng.com/file/similarpng/original-picture/2022/02/Romantic-pink-rose-bouquet-isolated-on-transparent-background-PNG.png" 
     class="flower-decor" 
     alt="Rose bouquet">

<div class="wrapper" id="app">
  <h1>To My Melanie (è”¡è¿å›·) ğŸ’•</h1>
  <p class="subtitle">Melanie, will you make my heart skip forever and be my Valentine? ğŸŒ¸ğŸ’–</p>

  <div class="buttons-container">
    <button id="yesBtn" class="not-ready" disabled>YESSS!! ğŸ’•ğŸ¥°</button>
    <button id="noBtn">No ğŸ™„ğŸ¥º</button>
  </div>
</div>

<audio id="pop" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-fast-small-sweep-transition-166.mp3"></audio>
<audio id="sparkle" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sweep-game-trophy-257.mp3"></audio>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const noBtn = document.getElementById("noBtn");
const yesBtn = document.getElementById("yesBtn");
const app = document.getElementById("app");
const pop = document.getElementById("pop");
const sparkle = document.getElementById("sparkle");

let noClickCount = 0;
let yesGrowing = false;
let yesScale = 1;

const noOptions = ["NOOO ğŸ˜±", "STOP ğŸ˜­", "WHY ğŸ˜µ", "PLS ğŸ˜¿", "ä¸å¥½ğŸ˜°"];

document.addEventListener('touchstart', () => {
  pop.volume = 0.6;
  sparkle.volume = 0.7;
}, { once: true });

// â”€â”€â”€ Heart trail (unchanged) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const heartChars = ["ğŸ’–","ğŸ’•","ğŸ’˜","ğŸ©·","ğŸ’—","ğŸ’","â¤ï¸","ğŸ’"];
let isDrawingHearts = false;
let lastX = 0, lastY = 0;
let throttleTimer = null;

function createTrailHeart(x, y) { /* unchanged */ }
// pointer event listeners (onPointerDown, onPointerMove, onPointerUp) unchanged

// â”€â”€â”€ Merge & explosion logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function triggerMergeAndCelebration() {
  // Play sound
  if (sparkle) {
    sparkle.currentTime = 0;
    sparkle.play().catch(()=>{});
  }

  const container = document.querySelector(".buttons-container");
  const yesRect = yesBtn.getBoundingClientRect();
  const noRect  = noBtn.getBoundingClientRect();

  // 1. Slide both buttons toward center
  yesBtn.style.transition = "transform 0.8s ease-in-out, opacity 0.6s ease 0.4s";
  noBtn.style.transition  = "transform 0.8s ease-in-out, opacity 0.6s ease 0.4s";

  yesBtn.style.transform = `translateX(${container.offsetWidth/2 - yesRect.left - yesRect.width/2}px) scale(0.9)`;
  noBtn.style.transform  = `translateX(-${noRect.right - container.offsetWidth/2 + noRect.width/2}px) scale(0.9)`;

  // 2. Create heart explosion at collision point
  setTimeout(() => {
    const centerX = container.offsetWidth / 2;
    const centerY = container.offsetHeight / 2;

    for (let i = 0; i < 12; i++) {
      const heart = document.createElement("div");
      heart.className = "heart-explosion";
      heart.textContent = "ğŸ’–";
      heart.style.left = centerX + "px";
      heart.style.top  = centerY + "px";
      heart.style.setProperty("--dx", (Math.random() - 0.5) * 220 + "px");
      heart.style.setProperty("--dy", (Math.random() - 0.5) * 220 + "px");
      heart.style.setProperty("--rot", (Math.random() * 720 - 360) + "deg");
      container.appendChild(heart);

      setTimeout(() => heart.remove(), 1400);
    }

    // Hide both buttons
    yesBtn.style.opacity = 0;
    noBtn.style.opacity  = 0;

    // 3. Show merged button
    const merged = document.createElement("button");
    merged.className = "merged-yes";
    merged.textContent = "YES FOREVER! ğŸ’˜";
    container.appendChild(merged);

    // Fade in merged button
    setTimeout(() => {
      merged.style.opacity = 1;
      merged.style.transition = "opacity 0.6s ease";
    }, 300);

    // 4. Go to final page after delay (or on click)
    const goToFinal = () => {
      merged.remove();
      finalYes();
    };

    merged.addEventListener("click", goToFinal);
    setTimeout(goToFinal, 2800); // auto-advance after ~2.8 seconds

  }, 900); // after slide completes
}

// â”€â”€â”€ No button logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
noBtn.addEventListener('click', () => {
  noClickCount++;
  
  if (noClickCount >= 5 && !yesGrowing) {
    yesGrowing = true;
    yesBtn.classList.add('surrenderYes');
    yesBtn.disabled = false;
    yesBtn.classList.remove('not-ready');

    // Enable YES click â†’ merge
    yesBtn.addEventListener('click', triggerMergeAndCelebration, { once: true });

    // Grow YES a little
    const growInterval = setInterval(() => {
      yesScale = Math.min(2.2, yesScale + 0.03);
      yesBtn.style.transform = `scale(${yesScale})`;
      if (yesScale >= 2.2) clearInterval(growInterval);
    }, 100);

    noBtn.textContent = "Okay fineâ€¦ Yes I will be! ğŸ˜ğŸ’•";
    noBtn.classList.add('surrender');

    // Clicking surrendered NO also triggers merge
    noBtn.onclick = triggerMergeAndCelebration;
  } else {
    const index = noClickCount - 1;
    noBtn.textContent = noOptions[index];
  }

  if (pop) {
    pop.currentTime = 0;
    pop.play().catch(() => {});
  }
});

// â”€â”€â”€ rest of your code (flower click, finalYes, createHeart, createFirework) remains unchanged â”€â”€

function finalYes() {
  if (sparkle) sparkle.play().catch(() => {});

  app.innerHTML = `
    <div style="overflow-y: auto; max-height: 90dvh; width: 100%; padding: 20px; box-sizing: border-box; -webkit-overflow-scrolling: touch;">
      <h1 style="font-size: clamp(3.5rem, 12vw, 5.5rem); color: white; margin: 20px 0; text-shadow: 0 4px 12px rgba(0,0,0,0.4);">
        YAYYY!!! ğŸ‰ğŸ’–
      </h1>
      <p class="handwritten">
        Melanie (è”¡è¿å›·), my heart has chosen you every single day... <br>
        Thank you for saying yes â€” I can't wait to hold your hand through every adventure, laugh, and quiet moment ahead. You are my forever. ğŸ’˜
      </p>
      <p class="ps">P.S. You're still the most beautiful thing I've ever seen, inside and out. ğŸŒ¹</p>
      
      <img src="https://i.postimg.cc/yYR21mkP/8b0f9164-ce1a-4748-9f48-386ba1f45bef.jpg" alt="Us together ğŸ’•" class="memory-photo">
      <p class="photo-caption" style="text-align:center; color:white; font-style:italic; margin-top: 15px;">Our favorite moment ğŸ’•</p>
    </div>
  `;

  document.body.style.background = "linear-gradient(135deg, #ff9a9e, #fad0c4, #ff9a9e)";
  document.body.style.animation = "breatheBg 12s ease infinite";

  setInterval(createHeart, 300);
  setInterval(createFirework, 700);
}

// createHeart, createFirework, flower click listener remain unchanged...
</script>

<noscript>
  <div style="text-align:center; font-size:1.5rem; color:#d63384; padding:40px;">
    <h1>To My Melanie ğŸ’•</h1>
    <p>(JavaScript is needed for the full romantic experience ğŸ˜Š)</p>
  </div>
</noscript>

</body>
</html>